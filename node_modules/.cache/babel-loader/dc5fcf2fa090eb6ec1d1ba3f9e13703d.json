{"ast":null,"code":"var _jsxFileName = \"/Users/zhengxinyue/PhpstormProjects/around-web2/around-web/src/components/Home.js\";\nimport React from 'react';\nimport { Tabs, Button, Spin } from 'antd';\nimport { GEO_OPTIONS, POS_KEY, API_ROOT, AUTH_HEADER, TOKEN_KEY } from '../constants';\nimport Main from \"./Main\";\nimport Gallery from './Gallery';\nconst TabPane = Tabs.TabPane;\n\nclass Home extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      isLoadingGeoLocation: false,\n      isLoadingPosts: false,\n      error: '',\n      posts: []\n    };\n\n    this.onSuccessLoadGeoLocation = position => {\n      console.log(position);\n      const _position$coords = position.coords,\n            latitude = _position$coords.latitude,\n            longitude = _position$coords.longitude;\n      localStorage.setItem(POS_KEY, JSON.stringify({\n        lat: latitude,\n        lon: longitude\n      }));\n      this.setState({\n        isLoadingGeoLocation: false,\n        error: ''\n      });\n      this.loadNearbyPosts();\n    };\n\n    this.onFailedLoadGeoLocation = () => {\n      this.setState({\n        isLoadingGeoLocation: false,\n        error: 'Failed to load geo location.'\n      });\n    };\n\n    this.loadNearbyPosts = () => {\n      const _JSON$parse = JSON.parse(localStorage.getItem(POS_KEY)),\n            lat = _JSON$parse.lat,\n            lon = _JSON$parse.lon;\n\n      const token = localStorage.getItem(TOKEN_KEY);\n      this.setState({\n        isLoadingPosts: true,\n        error: ''\n      });\n      fetch(`${API_ROOT}/search?lat=${lat}&lon=${lon}&range=20000`, {\n        method: 'GET',\n        headers: {\n          Authorization: `${AUTH_HEADER} ${token}`\n        }\n      }).then(response => {\n        if (response.ok) {\n          return response.json();\n        }\n\n        throw new Error('Failed to load post.');\n      }).then(data => {\n        console.log(data);\n        this.setState({\n          posts: data ? data : [],\n          isLoadingPosts: false\n        });\n      }).catch(e => {\n        console.error(e);\n        this.setState({\n          isLoadingPosts: false,\n          error: e.message\n        });\n      });\n    };\n  }\n\n  // When the component is rendered to the DOM for the first time\n  // such as at page load we call the Geolocation API to determine\n  // a latitude and longitude for the browser\n  componentDidMount() {\n    console.log(navigator.geolocation);\n\n    if (\"geolocation\" in navigator) {\n      this.setState({\n        isLoadingGeoLocation: true,\n        error: ''\n      });\n      navigator.geolocation.getCurrentPosition(this.onSuccessLoadGeoLocation, this.onFailedLoadGeoLocation, GEO_OPTIONS);\n    } else {\n      this.setState({\n        error: 'Geolocation is not supported.'\n      });\n    }\n  }\n\n  renderImagePosts() {\n    const _this$state = this.state,\n          error = _this$state.error,\n          isLoadingGeoLocation = _this$state.isLoadingGeoLocation,\n          isLoadingPosts = _this$state.isLoadingPosts,\n          posts = _this$state.posts;\n\n    if (error) {\n      return error;\n    } else if (isLoadingGeoLocation) {\n      return React.createElement(Spin, {\n        tip: \"Loading geo location...\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 79\n        },\n        __self: this\n      });\n    } else if (isLoadingPosts) {\n      return React.createElement(Spin, {\n        tip: \"Loading posts...\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 81\n        },\n        __self: this\n      });\n    } else if (posts.length > 0) {\n      const images = posts.map(post => {\n        return {\n          user: post.user,\n          src: post.url,\n          thumbnail: post.url,\n          caption: post.message,\n          thumbnailWidth: 400,\n          thumbnailHeight: 300\n        };\n      });\n      return React.createElement(Gallery, {\n        images: images,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93\n        },\n        __self: this\n      });\n    } else {\n      return 'No nearby posts';\n    }\n  }\n\n  render() {\n    const operations = React.createElement(Button, {\n      type: \"primary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100\n      },\n      __self: this\n    }, \"Create New Post\");\n    return React.createElement(Tabs, {\n      tabBarExtraContent: operations,\n      className: \"main-tabs\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102\n      },\n      __self: this\n    }, React.createElement(TabPane, {\n      tab: \"Image Posts\",\n      key: \"1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103\n      },\n      __self: this\n    }, this.renderImagePosts()), React.createElement(TabPane, {\n      tab: \"Video Posts\",\n      key: \"2\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106\n      },\n      __self: this\n    }, \"Content of tab 2\"), React.createElement(TabPane, {\n      tab: \"Map\",\n      key: \"3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109\n      },\n      __self: this\n    }, \"Content of tab 3\"));\n  }\n\n}\n\nexport default Home;","map":{"version":3,"sources":["/Users/zhengxinyue/PhpstormProjects/around-web2/around-web/src/components/Home.js"],"names":["React","Tabs","Button","Spin","GEO_OPTIONS","POS_KEY","API_ROOT","AUTH_HEADER","TOKEN_KEY","Main","Gallery","TabPane","Home","Component","state","isLoadingGeoLocation","isLoadingPosts","error","posts","onSuccessLoadGeoLocation","position","console","log","coords","latitude","longitude","localStorage","setItem","JSON","stringify","lat","lon","setState","loadNearbyPosts","onFailedLoadGeoLocation","parse","getItem","token","fetch","method","headers","Authorization","then","response","ok","json","Error","data","catch","e","message","componentDidMount","navigator","geolocation","getCurrentPosition","renderImagePosts","length","images","map","post","user","src","url","thumbnail","caption","thumbnailWidth","thumbnailHeight","render","operations"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Tabs, Button, Spin } from 'antd';\nimport { GEO_OPTIONS, POS_KEY, API_ROOT, AUTH_HEADER, TOKEN_KEY } from '../constants'\nimport Main from \"./Main\";\n\nimport Gallery from './Gallery';\n\n\nconst { TabPane } = Tabs;\n\nclass Home extends React.Component {\n    state = {\n        isLoadingGeoLocation: false,\n        isLoadingPosts: false,\n        error: '',\n        posts: [],\n    }\n\n    // When the component is rendered to the DOM for the first time\n    // such as at page load we call the Geolocation API to determine\n    // a latitude and longitude for the browser\n    componentDidMount() {\n        console.log(navigator.geolocation);\n        if (\"geolocation\" in navigator) {\n            this.setState({ isLoadingGeoLocation: true, error: '' });\n            navigator.geolocation.getCurrentPosition(\n                this.onSuccessLoadGeoLocation,\n                this.onFailedLoadGeoLocation,\n                GEO_OPTIONS,\n            );\n        } else {\n            this.setState({ error: 'Geolocation is not supported.'});\n        }\n    }\n\n    onSuccessLoadGeoLocation = (position) => {\n        console.log(position);\n        const { latitude, longitude } = position.coords;\n        localStorage.setItem(POS_KEY, JSON.stringify({ lat: latitude, lon: longitude }));\n        this.setState({ isLoadingGeoLocation: false, error: '' });\n        this.loadNearbyPosts();\n    }\n\n    onFailedLoadGeoLocation = () => {\n        this.setState({ isLoadingGeoLocation: false, error: 'Failed to load geo location.' });\n    }\n\n    loadNearbyPosts = () => {\n        const { lat, lon } = JSON.parse(localStorage.getItem(POS_KEY));\n        const token = localStorage.getItem(TOKEN_KEY);\n        this.setState({ isLoadingPosts: true, error: '' });\n        fetch(`${API_ROOT}/search?lat=${lat}&lon=${lon}&range=20000`, {\n            method: 'GET',\n            headers: {\n                Authorization: `${AUTH_HEADER} ${token}`\n            }\n        })\n            .then((response) => {\n                if (response.ok) {\n                    return response.json();\n                }\n                throw new Error('Failed to load post.');\n            })\n            .then((data) => {\n                console.log(data);\n                this.setState({ posts: data ? data : [], isLoadingPosts: false });\n            })\n            .catch((e) => {\n                console.error(e);\n                this.setState({ isLoadingPosts: false, error: e.message });\n            });\n    }\n\n    renderImagePosts() {\n        const { error, isLoadingGeoLocation, isLoadingPosts, posts } = this.state;\n        if (error) {\n            return error;\n        } else if (isLoadingGeoLocation) {\n            return <Spin tip=\"Loading geo location...\"/>;\n        } else if (isLoadingPosts) {\n            return <Spin tip=\"Loading posts...\"/>\n        } else if (posts.length > 0) {\n            const images = posts.map((post) => {\n                return {\n                    user: post.user,\n                    src: post.url,\n                    thumbnail: post.url,\n                    caption: post.message,\n                    thumbnailWidth: 400,\n                    thumbnailHeight: 300,\n                };\n            });\n            return <Gallery images={images}/>\n        } else {\n            return 'No nearby posts';\n        }\n    }\n\n    render() {\n        const operations = <Button type=\"primary\">Create New Post</Button>;\n        return (\n            <Tabs tabBarExtraContent={operations} className=\"main-tabs\">\n                <TabPane tab=\"Image Posts\" key=\"1\">\n                    {this.renderImagePosts()}\n                </TabPane>\n                <TabPane tab=\"Video Posts\" key=\"2\">\n                    Content of tab 2\n                </TabPane>\n                <TabPane tab=\"Map\" key=\"3\">\n                    Content of tab 3\n                </TabPane>\n            </Tabs>\n        );\n    }\n}\nexport default Home;\n\n"]},"metadata":{},"sourceType":"module"}