{"ast":null,"code":"import _classCallCheck from\"/Users/zhengxinyue/PhpstormProjects/around-web2/around-web/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/zhengxinyue/PhpstormProjects/around-web2/around-web/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/zhengxinyue/PhpstormProjects/around-web2/around-web/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/zhengxinyue/PhpstormProjects/around-web2/around-web/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/zhengxinyue/PhpstormProjects/around-web2/around-web/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import{Modal,Button,message}from'antd';import{CreatePostForm}from'./CreatePostForm';import{API_ROOT,AUTH_HEADER,TOKEN_KEY,POS_KEY,LOC_SHAKE,TOPIC_AROUND}from'../constants';export var CreatePostButton=/*#__PURE__*/function(_React$Component){_inherits(CreatePostButton,_React$Component);function CreatePostButton(){var _getPrototypeOf2;var _this;_classCallCheck(this,CreatePostButton);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(CreatePostButton)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={visible:false,confirmLoading:false};_this.showModal=function(){_this.setState({visible:true});};_this.handleOk=function(){_this.form.validateFields(function(err,values){console.log(values);if(!err){var token=localStorage.getItem(TOKEN_KEY);var _JSON$parse=JSON.parse(localStorage.getItem(POS_KEY)),lat=_JSON$parse.lat,lon=_JSON$parse.lon;var formData=new FormData();formData.set('lat',lat+Math.random()*LOC_SHAKE*2-LOC_SHAKE);formData.set('lon',lon+Math.random()*LOC_SHAKE*2-LOC_SHAKE);formData.set('message',values.message);formData.set('image',values.image[0].originFileObj);_this.setState({confirmLoading:true});fetch(\"\".concat(API_ROOT,\"/post\"),{method:'POST',headers:{Authorization:\"\".concat(AUTH_HEADER,\" \").concat(token)},body:formData}).then(function(response){if(response.ok){return _this.props.loadPostsByTopic();}throw new Error('Failed to create post.');}).then(function(){_this.setState({visible:false,confirmLoading:false});_this.form.resetFields();message.success('Post created successfully!');}).catch(function(e){console.error(e);message.error('Failed to create post.');_this.setState({confirmLoading:false});});}});};_this.handleCancel=function(){console.log('Clicked cancel button');_this.setState({visible:false});};_this.getFormRef=function(formInstance){_this.form=formInstance;};return _this;}_createClass(CreatePostButton,[{key:\"render\",value:function render(){var _this$state=this.state,visible=_this$state.visible,confirmLoading=_this$state.confirmLoading;return React.createElement(\"div\",null,React.createElement(Button,{type:\"primary\",onClick:this.showModal},\"Create New Post\"),React.createElement(Modal,{title:\"Create New Post\",visible:visible,onOk:this.handleOk,okText:\"Create\",confirmLoading:confirmLoading,onCancel:this.handleCancel},React.createElement(CreatePostForm,{ref:this.getFormRef})));}}]);return CreatePostButton;}(React.Component);","map":{"version":3,"sources":["/Users/zhengxinyue/PhpstormProjects/around-web2/around-web/src/components/CreatePostButton.js"],"names":["React","Modal","Button","message","CreatePostForm","API_ROOT","AUTH_HEADER","TOKEN_KEY","POS_KEY","LOC_SHAKE","TOPIC_AROUND","CreatePostButton","state","visible","confirmLoading","showModal","setState","handleOk","form","validateFields","err","values","console","log","token","localStorage","getItem","JSON","parse","lat","lon","formData","FormData","set","Math","random","image","originFileObj","fetch","method","headers","Authorization","body","then","response","ok","props","loadPostsByTopic","Error","resetFields","success","catch","e","error","handleCancel","getFormRef","formInstance","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Modal, Button, message } from 'antd';\nimport { CreatePostForm } from './CreatePostForm';\nimport { API_ROOT, AUTH_HEADER, TOKEN_KEY, POS_KEY, LOC_SHAKE, TOPIC_AROUND } from '../constants';\n\nexport class CreatePostButton extends React.Component {\n    state = {\n        visible: false,\n        confirmLoading: false,\n    };\n\n    showModal = () => {\n        this.setState({\n            visible: true,\n        });\n    };\n\n    handleOk = () => {\n        this.form.validateFields((err, values) => {\n            console.log(values);\n            if (!err) {\n                const token = localStorage.getItem(TOKEN_KEY);\n                const { lat, lon } = JSON.parse(localStorage.getItem(POS_KEY));\n\n                const formData = new FormData();\n                formData.set('lat', lat + Math.random() * LOC_SHAKE * 2 - LOC_SHAKE);\n                formData.set('lon', lon + Math.random() * LOC_SHAKE * 2 - LOC_SHAKE);\n                formData.set('message', values.message);\n                formData.set('image', values.image[0].originFileObj);\n\n                this.setState({ confirmLoading: true });\n                fetch(`${API_ROOT}/post`, {\n                    method: 'POST',\n                    headers: {\n                        Authorization: `${AUTH_HEADER} ${token}`\n                    },\n                    body: formData,\n                })\n                    .then((response) => {\n                        if (response.ok) {\n                            return this.props.loadPostsByTopic();\n                        }\n                        throw new Error('Failed to create post.');\n                    })\n                    .then(() => {\n                        this.setState({ visible: false, confirmLoading: false });\n                        this.form.resetFields();\n                        message.success('Post created successfully!');\n                    })\n                    .catch((e) => {\n                        console.error(e);\n                        message.error('Failed to create post.');\n                        this.setState({ confirmLoading: false });\n                    });\n            }\n        });\n    };\n\n    handleCancel = () => {\n        console.log('Clicked cancel button');\n        this.setState({\n            visible: false,\n        });\n    };\n\n    getFormRef = (formInstance) => {\n        this.form = formInstance;\n    }\n\n    render() {\n        const { visible, confirmLoading } = this.state;\n        return (\n            <div>\n                <Button type=\"primary\" onClick={this.showModal}>\n                    Create New Post\n                </Button>\n                <Modal\n                    title=\"Create New Post\"\n                    visible={visible}\n                    onOk={this.handleOk}\n                    okText='Create'\n                    confirmLoading={confirmLoading}\n                    onCancel={this.handleCancel}\n                >\n                    <CreatePostForm ref={this.getFormRef}/>\n                </Modal>\n            </div>\n        );\n    }\n}\n"]},"metadata":{},"sourceType":"module"}